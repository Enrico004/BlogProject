{% extends "base.html" %}
{% block title %}Login{% endblock %}

{% block content %}
    <div id="blog-details" data-blog-id="{{ blog.id }}">
     <h1>{{ blog.title }}</h1>
        <p>{{ blog.content }}</p>
        <p>Erstellt am: {{ blog.created_date|date:"d.m.Y H:i" }}</p>
        <p>Autor: {{ blog.author }}</p>
        <p>Aufrufe: {{ blog.clicks }}</p>
        {% if user.is_authenticated %}
            {% csrf_token %}
        <div id="like-section" data-post-id="{{ blog.id }}">
            <button id="like-button"></button>
        </div>{% endif %}
        <strong class="text-secondary">{{ number_of_likes }} Like{{ number_of_likes|pluralize }}</strong>
    </div>

    <!-- Button zurück zur Dashboard-Ansicht -->

    <style>
    .button {
        display: inline-block;
        padding: 10px 20px;
        font-size: 16px;
        color: white;
        background-color: #007bff;
        text-decoration: none;
        border-radius: 4px;
    }
    .button:hover {
        background-color: #0056b3;
    }
</style>
<script>
    document.getElementById('like-button').addEventListener('click', function () {

        //TODO
        const csrftoken = '{{ csrf_token }}';  // Ensure CSRF token is passed
        const blogDetails = document.getElementById('blog-details'); // Select the blog details div
        const blogId = blogDetails.dataset.blogId;
        console.log(this.dataset)
        fetch(`/blogs/like-post/${blogId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
            // Update the button text and like count
            this.textContent = data.liked ? 'Unlike' : 'Like';
            document.getElementById('like-count').textContent = data.like_count;
        })
        .catch(error => console.error('Error:', error));
    });
</script>
    <a href="{% url 'blog_dashboard' %}" class="button">Zurück zum Dashboard</a>
{% endblock %}

