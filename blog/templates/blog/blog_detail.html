{% extends "base.html" %}
{% block title %}Login{% endblock %}

{% block content %}
    <div id="blog-details" data-blog-id="{{ blog.id }}">
     <h1>{{ blog.title }}</h1>
        <p>{{ blog.content }}</p>
        <p>Erstellt am: {{ blog.created_date|date:"d.m.Y H:i" }}</p>
        <p>Autor: {{ blog.author }}</p>
        <img src="{{ blog.author.profile.avatar.url }}">
        <p>Aufrufe: {{ blog.clicks }}</p>
        {% if user.is_authenticated %}
            <button id="like-button" data-liked="{% if user in blog.likes.all %}true{% else %}false{% endif %}">
                {% if user in blog.likes.all %}
                    Unlike
                {% else %}
                    Like
                {% endif %}
            </button>
        {% endif %}
        <strong class="text-secondary" id="like-count">{{ number_of_likes }} Like{{ number_of_likes|pluralize }}</strong>
    </div>

    <!-- Button zurück zur Dashboard-Ansicht -->

    <style>
    .button {
        display: inline-block;
        padding: 10px 20px;
        font-size: 16px;
        color: white;
        background-color: #007bff;
        text-decoration: none;
        border-radius: 4px;
    }
    .button:hover {
        background-color: #0056b3;
    }
</style>
<script>
    const likeButton = document.getElementById('like-button');
    const likeCountElement = document.getElementById('like-count');

    likeButton.addEventListener('click', function () {
        const postId = {{ blog.id }};
        const csrfToken = '{{ csrf_token }}';

        fetch(`/blogs/like/${postId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            // after receiving response from the backend update the content of the like-count element
            likeButton.innerText = data.liked ? 'Unlike' : 'Like';
            if(data.like_count === 1)
                text = 'Like';
            else{
                text = 'Likes';
            }
            likeCountElement.innerText = `${data.like_count} ${text}`;
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
</script>
    <a href="{% url 'blog_dashboard' %}" class="button">Zurück zum Dashboard</a>
{% endblock %}

